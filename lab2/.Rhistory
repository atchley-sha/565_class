"\U00B1",
round(1.96 * HBWsd / sqrt(n), digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>% #for formatting
add_header_lines("HBW Confidence Intervals")
hhprod_sum()
hhprod_sum()
hhprod_sum()
hhprod_sum()
hhprod_sum()
hhprod_sum()
read.dbf("dbf/HH_PROD2.dbf") %>% round(digits = 2) %>% head()
read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>% colSums() %>% round(digits = 0)
HBW <- tibble(
c("wrkcount", "0 vehicles", "1 vehicles", "2 vehicles"),
c(0, 0, 0, 0, 0),
c(1, 0.32, 0.95, 1.17, 0.97),
c(2, 2.3, 1.84, 2.2, 2.5)
)
HBW <- tibble(
c("wrkcount", "0 vehicles", "1 vehicles", "2 vehicles", "3 vehicles"),
c(0, 0, 0, 0, 0),
c(1, 0.32, 0.95, 1.17, 0.97),
c(2, 2.3, 1.84, 2.2, 2.5)
)
View(HBW)
HBW <- tibble(
c(0, 0, 0, 0, 0),
c(1, 0.32, 0.95, 1.17, 0.97),
c(2, 2.3, 1.84, 2.2, 2.5)
)
View(HBW)
HBW <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2, 2.2),
c(0, 0.97, 2.5, 2.5)
)
HBW <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2),
c(0, 0.97, 2.5)
)
View(HBW)
colnames(HBW) <- c("wrkcount", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
View(HBW)
sums <- read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>%
colSums() %>% round(digits = 0)
sums
HBW <- HBW * 118653 / sums$HBWP
HBW <- HBW * 118653 / sums["HBWP"]
HBW
HBW <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2),
c(0, 0.97, 2.5)
)
colnames(HBW) <- c("wrkcount", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
sums <- read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>%
colSums() %>% round(digits = 0)
HBW <- HBW * 118653 / sums["HBWP"] %>% round(digits = 3)
HBW
HBW <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2),
c(0, 0.97, 2.5)
)
colnames(HBW) <- c("wrkcount", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
sums <- read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>%
colSums() %>% round(digits = 0)
HBW <- (HBW * 118653 / sums["HBWP"]) %>% round(digits = 3)
HBW
sums
HBSHOP <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2),
c(0, 0.97, 2.5)
)
sums <- read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>%
colSums() %>% round(digits = 0)
HBW <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2),
c(0, 0.97, 2.5)
)
colnames(HBW) <- c("wrkcount", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBW <- (HBW * 118653 / sums["HBWP"]) %>% round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
HBO <- tibble(
c(1, 2, 3, 4),
c(0.5, .68, 3.85, 4.8),
c(.6, 1.2, 1.2, 6),
c(.6, 1.2, 2.25, 4.7),
c(.6, 1.2, 2.1, 4.5)
)
colnames(HBO) <- c("hhsize", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBO <- (HBO * 267987 / sums["HBOP"]) %>% round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
HBSHOP <- tibble(
c(1, 2, 3, 4),
c(.601, 1.4, 1.8, 1.8),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.6, 1.7, 1.7)
)
colnames(HBSHOP) <- c("hhsize", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBSHOP <- (HBSHOP * 129614 / sums["HBSHOPP"]) %>% round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
sums
sums <- read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>%
colSums() %>% round(digits = 0)
HBW <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2),
c(0, 0.97, 2.5)
)
colnames(HBW) <- c("wrkcount", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBW <- (HBW * 118653 / sums["HBWP"]) %>% round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
HBO <- tibble(
c(1, 2, 3, 4),
c(0.5, .68, 3.85, 4.8),
c(.6, 1.2, 1.2, 6),
c(.6, 1.2, 2.25, 4.7),
c(.6, 1.2, 2.1, 4.5)
)
colnames(HBO) <- c("hhsize", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBO <- (HBO * 267987 / sums["HBOP"]) %>% round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
HBSHOP <- tibble(
c(1, 2, 3, 4),
c(.601, 1.4, 1.8, 1.8),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.6, 1.7, 1.7)
)
colnames(HBSHOP) <- c("hhsize", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBSHOP <- (HBSHOP * 129614 / sums["HBSHP"]) %>% round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
sums
HBSHOP <- tibble(
c(1, 2, 3, 4),
c(.601, 1.4, 1.8, 1.8),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.6, 1.7, 1.7)
)
HBSHOP <- tibble(
c(1, 2, 3, 4),
c(.601, 1.4, 1.8, 1.8),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.6, 1.7, 1.7),
.name_repair = "unique"
)
sums <- read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>%
colSums() %>% round(digits = 0)
HBW <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2),
c(0, 0.97, 2.5)
)
colnames(HBW) <- c("wrkcount", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBW <- (HBW * 118653 / sums["HBWP"]) %>% round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
HBO <- tibble(
c(1, 2, 3, 4),
c(0.5, .68, 3.85, 4.8),
c(.6, 1.2, 1.2, 6),
c(.6, 1.2, 2.25, 4.7),
c(.6, 1.2, 2.1, 4.5)
)
colnames(HBO) <- c("hhsize", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBO <- (HBO * 267987 / sums["HBOP"]) %>% round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
HBSHOP <- tibble(
c(1, 2, 3, 4),
c(.601, 1.4, 1.8, 1.8),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.6, 1.7, 1.7),
.name_repair = "unique"
)
colnames(HBSHOP) <- c("hhsize", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBSHOP <- (HBSHOP * 129614 / sums["HBSHP"]) %>% round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
tibble(
c("HBW", "HBO", "HBSHOP"),
c(118653, 267987, 129614),
c(122135, 269084, 129759),
c("-2.93%", "-0.41%", "-0.11%")
)
if(!require(pacman)) install.packages(pacman)
pacman::p_load(
pacman,
tidyverse,
remotes,
knitr,
sjlabelled,
flextable,
jtools,
foreign,
scales
)
if(!require(nhts2017)) remotes::install_github("byu-transpolab/nhts2017")
p_load(nhts2017)
options(dplyr.summarise.inform = FALSE)
set_flextable_defaults(fonts_ignore=TRUE)
tibble(
c("HBW", "HBO", "HBSHOP"),
c(118653, 267987, 129614),
c(122135, 269084, 129759),
c("-2.93%", "-0.41%", "-0.11%")
)
tibble(
c("HBW", "HBO", "HBSHOP"),
c(118653, 267987, 129614),
c(122135, 269084, 129759),
c("-2.93%", "-0.41%", "-0.11%")
) %>%
my_flextable()
# Chunk 1: setup
knitr::opts_chunk$set(
echo = TRUE,
message = FALSE,
warning = FALSE
)
# Chunk 2: load_packages
if(!require(pacman)) install.packages(pacman)
pacman::p_load(
pacman,
tidyverse,
remotes,
knitr,
sjlabelled,
flextable,
jtools,
foreign,
scales
)
if(!require(nhts2017)) remotes::install_github("byu-transpolab/nhts2017")
p_load(nhts2017)
options(dplyr.summarise.inform = FALSE)
set_flextable_defaults(fonts_ignore=TRUE)
# Chunk 3: load_data
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0
mutate_at(vars(names(trips)), nato0)
##Create tables ####
###formatting tables function
my_flextable <- function(tibble){
flextable(tibble) %>%
autofit() %>%
align(align = "center", part = "all")
}
###
#For HBW
HBW <- tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
HBW = weighted.mean(HBW, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
#For HBSHOP
HBSHOP <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBSHOP) %>%
round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
#For HBO
HBO <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBO = weighted.mean(HBO, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBO) %>%
round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
# Chunk 4: sample_se
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = paste(
"\U00B1",
round(1.96 * HBWsd / sqrt(n), digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>% #for formatting
add_header_lines("HBW Confidence Intervals")
# Chunk 5: se
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = paste(
"\U00B1",
round(1.96 * HBSHOPsd / sqrt(n), digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBO
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBOsd = wtd.sd(HBO, wthhfin)
) %>%
mutate(
conf = paste(
"\U00B1",
round(1.96 * HBOsd / sqrt(n), digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>%
add_header_lines("HBO Confidence Intervals")
# Chunk 6: fix_tables
HBW[1,] <- as.list(rep.int(0, times = 5))
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBSHOP[2,5] <- 1.781
HBSHOP[3,3:4] <- list(1.8,1.8)
HBSHOP[4,5] <- 1.84
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
HBO[1,3:5] <- list(.558,.558,.558)
HBO[3,2] <- 3
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
# Chunk 7: hhprod1
read.dbf("dbf/HH_PROD1.DBF") %>% round(digits = 2) %>% head()
# Chunk 8: sum1
read.dbf("dbf/HH_PROD1.DBF")[,c(2,4,6)] %>% colSums() %>% round(digits = 0)
# Chunk 9: hhprod2
read.dbf("dbf/HH_PROD2.dbf") %>% round(digits = 2) %>% head()
read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>% colSums() %>% round(digits = 0)
# Chunk 10: final_rates
sums <- read.dbf("dbf/HH_PROD2.dbf")[,c(2,4,6)] %>%
colSums() %>% round(digits = 0)
HBW <- tibble(
c(0, 1, 2),
c(0, 0.32, 2.3),
c(0, 0.95, 1.84),
c(0, 1.17, 2.2),
c(0, 0.97, 2.5)
)
colnames(HBW) <- c("wrkcount", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBW[,-1] <- (HBW[,-1] * 118653 / sums["HBWP"]) %>% round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
HBO <- tibble(
c(1, 2, 3, 4),
c(0.5, .68, 3.85, 4.8),
c(.6, 1.2, 1.2, 6),
c(.6, 1.2, 2.25, 4.7),
c(.6, 1.2, 2.1, 4.5)
)
colnames(HBO) <- c("hhsize", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBO[,-1] <- (HBO[,-1] * 267987 / sums["HBOP"]) %>% round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
HBSHOP <- tibble(
c(1, 2, 3, 4),
c(.601, 1.4, 1.8, 1.8),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.4, 1.4, 1.6),
c(.874, 1.6, 1.7, 1.7),
.name_repair = "unique"
)
colnames(HBSHOP) <- c("hhsize", "0 vehicles", "1 vehicle", "2 vehicles", "3 vehicles")
HBSHOP[,-1] <- (HBSHOP[,-1] * 129614 / sums["HBSHP"]) %>% round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
tibble(
c("HBW", "HBO", "HBSHOP"),
c(118653, 267987, 129614),
c(122135, 269084, 129759),
c("-2.93%", "-0.41%", "-0.11%")
) %>%
my_flextable()
?colnames
?colnames<-
()
?`colnames<-`
attr <- tibble(
c("HBW", "HBO", "HBSHOP"),
c(118653, 267987, 129614),
c(122135, 269084, 129759),
c("-2.93%", "-0.41%", "-0.11%")
) %>%
`colnames<-`(c("Purpose", "Target Value", "Final Value", "Margin of Error")) %>%
my_flextable()
View(attr)
tibble(
c("HBW", "HBO", "HBSHOP"),
c(118653, 267987, 129614),
c(122135, 269084, 129759),
c("-2.93%", "-0.41%", "-0.11%")
) %>%
`colnames<-`(c("Purpose", "Target Value", "Final Value", "Margin of Error")) %>%
my_flextable()
rm(attr\)
rm(attr)
tibble(
c(0,1,2,3),
c(0, 0.299, 1.51, 2.21),
c(0, .889, 1.721, 2.36),
c(0, 1.095, 2.058, 2.74),
c(0, 1.101, 2.339, 2.92)
) %>%
`colnames<-`(c("wrkcount", "0 vehicles", "1 vehicles", "2 vehicles", "3 vehicles")) %>%
my_flextable()
tibble(
c("HBW", "HBO", "HBSHOP"),
c(118653, 267987, 129614),
c(122135, 269084, 129759),
c("-2.93%", "-0.41%", "-0.11%")
) %>%
`colnames<-`(c("Purpose", "Target Value", "Final Value", "Margin of Error")) %>%
my_flextable()
