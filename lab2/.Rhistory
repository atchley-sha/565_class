n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.01, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.01, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 3), round(conf, digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 3), round(conf, digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 3, 3, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0
mutate_at(vars(names(trips)), nato0)
##Create tables ####
###formatting tables function
my_flextable <- function(tibble){
flextable(tibble) %>%
autofit() %>%
align(align = "center", part = "all")
}
###
#For HBW
HBW <- tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
HBW = weighted.mean(HBW, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
#For HBSHOP
HBSHOP <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBSHOP) %>%
round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
#For HBO
HBO <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBO = weighted.mean(HBO, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBO) %>%
round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
if(!require(pacman)) install.packages(pacman)
pacman::p_load(
pacman,
tidyverse,
remotes,
knitr,
sjlabelled,
flextable,
jtools,
foreign,
scales
)
if(!require(nhts2017)) remotes::install_github("byu-transpolab/nhts2017")
p_load(nhts2017)
options(dplyr.summarise.inform = FALSE)
set_flextable_defaults(fonts_ignore=TRUE)
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 3, 3, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0
mutate_at(vars(names(trips)), nato0)
##Create tables ####
###formatting tables function
my_flextable <- function(tibble){
flextable(tibble) %>%
autofit() %>%
align(align = "center", part = "all")
}
###
#For HBW
HBW <- tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
HBW = weighted.mean(HBW, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
#For HBSHOP
HBSHOP <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBSHOP) %>%
round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
#For HBO
HBO <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBO = weighted.mean(HBO, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBO) %>%
round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
View(HBW)
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 3), round(conf, digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0
mutate_at(vars(names(trips)), nato0)
##Create tables ####
###formatting tables function
my_flextable <- function(tibble){
flextable(tibble) %>%
autofit() %>%
align(align = "center", part = "all")
}
###
#For HBW
HBW <- tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
HBW = weighted.mean(HBW, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
#For HBSHOP
HBSHOP <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBSHOP) %>%
round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
#For HBO
HBO <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBO = weighted.mean(HBO, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBO) %>%
round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
View(HBW)
HBW
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0
mutate_at(vars(names(trips)), nato0)
##Create tables ####
###formatting tables function
my_flextable <- function(tibble){
flextable(tibble) %>%
autofit() %>%
align(align = "center", part = "all")
}
###
#For HBW
HBW <- tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
HBW = weighted.mean(HBW, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
round(digits = 3)
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
#For HBSHOP
HBSHOP <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBSHOP) %>%
round(digits = 3)
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
#For HBO
HBO <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBO = weighted.mean(HBO, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBO) %>%
round(digits = 3)
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
HBW[1,] <- rep.int(0, times = 5)
HBSHOP[1,3:5] <- rep.int(.874, times = 3)
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBSHOP[2,5] <- 1.781
HBW
HBW
HBW[1,] <- rep.int(0, times = 5)
HBSHOP[1,3:5] <- rep.int(.874, times = 3)
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBSHOP[2,5] <- 1.781
HBW
HBW[1,] <- rep.int(0, times = 5)
HBW[1,] <- c(0,0,0,0,0)
HBW[1,] <- list(0,0,0,0,0)
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBW[1,] <- as.list(rep.int(0, times = 5))
HBW
HBW[1,] <- as.list(rep.int(0, times = 5))
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBSHOP[2:4,2] <- as.list(rep.int(2, times = 3))
HBSHOP[2,5] <- 1.781
HBW[1,] <- as.list(rep.int(0, times = 5))
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBSHOP[2:4,2] <- as.list(rep.int(2, times = 3))
HBSHOP[2,5] <- 1.781
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBW[1,] <- as.list(rep.int(0, times = 5))
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBSHOP[2,5] <- 1.781
HBW
HBSHOP
HBW[1,] <- as.list(rep.int(0, times = 5))
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBSHOP[2,5] <- 1.781
HBSHOP[3,3:4] <- list(1.8,1.8)
HBSHOP[4,5] <- 1.84
HBSHOP
HBO
HBO[1,3:5] <- list(.558,.558,.558)
HBO
HBO[3,2] <- 3
HBO
HBW[1,] <- as.list(rep.int(0, times = 5))
HBW
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBSHOP[2,5] <- 1.781
HBSHOP[3,3:4] <- list(1.8,1.8)
HBSHOP[4,5] <- 1.84
HBSHOP
HBO[1,3:5] <- list(.558,.558,.558)
HBO[3,2] <- 3
HBO
read.dbf("dbf/HH_PROD1.dbf")
getwd()
read.dbf("dbf/HH_PROD1.DBF")
rmarkdown::pandoc_version()
read.dbf("dbf/HH_PROD1.dbf") %>% round(digits = 2) %>% head()
read.dbf("dbf/HH_PROD1.dbf")[,-1] %>% round(digits = 0) %>% colSums()
read.dbf("dbf/HH_PROD1.dbf")[,c(2,4,6)] %>% round(digits = 0) %>% colSums()
HBW[1,] <- as.list(rep.int(0, times = 5))
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBSHOP[2,5] <- 1.781
HBSHOP[3,3:4] <- list(1.8,1.8)
HBSHOP[4,5] <- 1.84
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
HBO[1,3:5] <- list(.558,.558,.558)
HBO[3,2] <- 3
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
HBW[1,] <- as.list(rep.int(0, times = 5))
HBW %>%
my_flextable() %>%
add_header_lines("HBW")
HBSHOP[1,3:5] <- as.list(rep.int(.874, times = 3))
HBSHOP[2:4,2] <- rep.int(2, times = 3)
HBSHOP[2,5] <- 1.781
HBSHOP[3,3:4] <- list(1.8,1.8)
HBSHOP[4,5] <- 1.84
HBSHOP %>%
my_flextable() %>%
add_header_lines("HBSHOP")
HBO[1,3:5] <- list(.558,.558,.558)
HBO[3,2] <- 3
HBO %>%
my_flextable() %>%
add_header_lines("HBO")
read.dbf("dbf/HH_PROD1.dbf")[,c(2,4,6)] %>% colSums() %>% round(digits = 0)
