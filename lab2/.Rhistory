flextable() %>%
autofit() %>%
align(align = "center", part = "all")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
HBW = weighted.mean(HBW, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
round(digits = 2) %>%
flextable() %>%
autofit() %>%
align(align = "center", part = "all") %>%
add_header_lines("HBW")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
round(digits = 2) %>%
flextable() %>%
autofit() %>%
align(align = "center", part = "all") %>%
add_header_lines("HBSHOP")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBSHOP) %>%
round(digits = 2) %>%
flextable() %>%
autofit() %>%
align(align = "center", part = "all") %>%
add_header_lines("HBSHOP")
#For HBO
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBO = weighted.mean(HBO, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBO) %>%
round(digits = 2) %>%
flextable() %>%
autofit() %>%
align(align = "center", part = "all") %>%
add_header_lines("HBO")
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0
mutate_at(vars(names(trips)), nato0)
##Create tables ####
#formatting tables function
my_flextable <- function(tibble){
round(tibble, digits = 2) %>%
flextable() %>%
autofit() %>%
align(align = "center", part = "all")
}
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
HBW = weighted.mean(HBW, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
my_flextable() %>%
add_header_lines("HBW")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBSHOP) %>%
my_flextable() %>%
add_header_lines("HBSHOP")
#For HBO
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBO = weighted.mean(HBO, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBO) %>%
my_flextable() %>%
add_header_lines("HBO")
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
hhvehcnt = paste(hhvehcnt, "vehicles")
)
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>%
add_header_lines("HBW Standard Error")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
# HBWsd = wtd.sd(HBW, wthhfin)
HBWsd = sd(HBW)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
# HBWsd = wtd.sd(HBW, wthhfin)
HBWsd = sd(HBW)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf)
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
# HBWsd = sd(HBW)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf)
pacman::p_load(
pacman,
tidyverse,
remotes,
knitr,
sjlabelled,
flextable,
jtools,
foreign,
scales
)
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2 %>%
scientific(digits = 2),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = scientific(1.96 * HBWsd / n^2, digits = 2),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
q
q
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = scientific(1.96 * HBWsd / n^2, digits = 2),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = scientific(conf, digits = 2),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = scientific(conf, digits = 2),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = scientific(conf, digits = 2),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci)
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0
mutate_at(vars(names(trips)), nato0)
##Create tables ####
###formatting tables function
my_flextable <- function(tibble){
flextable(tibble) %>%
autofit() %>%
align(align = "center", part = "all")
}
###
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
HBW = weighted.mean(HBW, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBW) %>%
round(digits = 2) %>%
my_flextable() %>%
add_header_lines("HBW")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBSHOP = weighted.mean(HBSHOP, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBSHOP) %>%
round(digits = 2) %>%
my_flextable() %>%
add_header_lines("HBSHOP")
#For HBO
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
HBO = weighted.mean(HBO, wthhfin)
) %>%
mutate(hhvehcnt = paste(hhvehcnt, "vehicles")) %>%
pivot_wider(names_from = hhvehcnt, values_from = HBO) %>%
round(digits = 2) %>%
my_flextable() %>%
add_header_lines("HBO")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = scientific(conf, digits = 2),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = ifelse(conf < 0.01, scientific(conf, digits = 2), conf),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = ifelse(conf < 0.01, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBO
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBOsd = wtd.sd(HBO, wthhfin)
) %>%
mutate(
conf = 1.96 * HBOsd / n^2,
conf_sci = ifelse(conf < 0.01, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBO Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.01, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.01, scientific(conf, digits = 2), round(conf, digits = 2)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
#For HBW
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBWsd = wtd.sd(HBW, wthhfin)
) %>%
mutate(
conf = 1.96 * HBWsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 3), round(conf, digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = wrkcount, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBW Confidence Intervals")
#For HBSHOP
tripprod %>%
group_by(hhsize, hhvehcnt) %>%
summarize(
n = n(),
HBSHOPsd = wtd.sd(HBSHOP, wthhfin)
) %>%
mutate(
conf = 1.96 * HBSHOPsd / n^2,
conf_sci = ifelse(conf < 0.001, scientific(conf, digits = 3), round(conf, digits = 3)),
hhvehcnt = paste(hhvehcnt, "vehicles")
) %>%
pivot_wider(id_cols = hhsize, names_from = hhvehcnt, values_from = conf_sci) %>%
my_flextable() %>%
add_header_lines("HBSHOP Confidence Intervals")
