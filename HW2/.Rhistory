tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0.a
mutate_at(vars(names(trips)), nato0)
tripprod
tripprod
tripprod
tripprod %>%
group_by(hhsize, hhfaminc)
tripprod %>%
group_by(hhsize, hhfaminc)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize()
colnames(tripprod)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean('-9', wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(-9, wthhfin),
)
\% hello
# 2.1
Using this data, we can calculate trip rates by household size and income group:
```{r hh_size_and_income}
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(-9, wthhfin),
)
```
% hello
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
# Other = weighted.mean(-9, wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(tripprod$`-9`, wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(tripprod$'-9', wthhfin),
)
colnames(tripprod)
n(colnames(tripprod))
count(colnames(tripprod))
length(colnames(tripprod))
colnames(tripprod) <- c(
colnames(tripprod)[1,length(colnames(tripprod))-1],
"Other")
colnames(tripprod) <- c(
colnames(tripprod)[1,12],
"Other")
colnames(tripprod) <- c(
colnames(tripprod)[1:length(colnames(tripprod))-1],
"Other")
tripprod
colnames(tripprod)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
) %>%
print.data.frame()
if(!require(pacman)) install.packages(pacman)
pacman::p_load(
pacman,
tidyverse,
remotes,
nhts2017,
kableExtra
)
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse, remotes, nhts2017)
pacman::p_load(pacman, tidyverse, remotes, knitr, nhts2017)
tripprod
# Chunk 1: setup
knitr::opts_chunk$set(
echo = TRUE,
message = FALSE,
warning = FALSE
)
# Chunk 2: load_packages
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse, remotes, knitr, nhts2017)
# Chunk 3: load_data
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0.a
mutate_at(vars(names(trips)), nato0)
# Chunk 4: rename_9
colnames(tripprod) <- c(
colnames(tripprod)[1:length(colnames(tripprod))-1],
"Other")
tripprod
# Chunk 5: hh_size_and_income
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
) %>%
knitr::kable()
tripprod
as_label(tripprod$hhfaminc)
to_factor
as.factor(tripprod$hhfaminc)
attr(tripprod$hhfaminc, "label")
attr(tripprod$hhfaminc, "var.label")
attr(tripprod$hhfaminc, "var.labels")
description(tripprod)
subset(tripprod$hhfaminc)
subset(tripprod$hhfaminc, subset = TRUE)
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse, remotes, knitr, nhts2017, sjlabelled)
library(sjlabelled)
get_labels(tripprod$hhfaminc)
to_label(tripprod$hhfaminc)
tripprod$hhfaminc
to_label(tripprod$hhfaminc)
tripprod$hhfaminc
to_character(tripprod$hhfaminc)
to_factor(tripprod$hhfaminc)
as_label(tripprod$hhfaminc, add.non.labelled = TRUE)
tripprod
head(as_label(tripprod$hhfaminc))
head(tripprod$hhfaminc)
as_label(tripprod)
to_label(tripprod$hhfaminc)
as_label(tripprod$hhfaminc)
as_labelled(tripprod$hhfaminc)
tripprod
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
) %>%
as_label() %>%
knitr::kable()
tripprod
tripprod$hhfaminc
attr(tripprod$hhfaminc, "label")
attr(tripprod$hhfaminc, "labels")
# Chunk 1: setup
knitr::opts_chunk$set(
echo = TRUE,
message = FALSE,
warning = FALSE
)
# Chunk 2: load_packages
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse, remotes, knitr, sjlabelled, flextable, jtools)
remotes::install_github("byu-transpolab/nhts2017")
p_load(nhts2017)
options(dplyr.summarise.inform = FALSE)
set_flextable_defaults(fonts_ignore=TRUE)
# Chunk 3: load_data
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0
mutate_at(vars(names(trips)), nato0)
# Format table
tripprod %>%
head(n = 10L) %>%
flextable() %>%
theme_booktabs() %>%
align(align = "center", part = "all") %>%
autofit(add_w = 0, add_h = 0) %>%
fit_to_width(6)
# Chunk 4: hh_size_and_income
tripprod$hhfaminc <- as_factor(tripprod$hhfaminc) #better data type for manipulation
tripprod <- tripprod %>%
filter(!hhfaminc %in% c("-7", "-8", "-9")) %>%
group_by(hhsize, hhfaminc) %>%
arrange(hhsize, hhfaminc)
tripprod$hhfaminc <- as_label(tripprod$hhfaminc) #to show text instead of numbers
tripprod %>%
summarize(
n = n(),
HBW = weighted.mean(HBW, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBO = weighted.mean(HBO, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
"\U03A3" = HBW + HBSHOP + HBSOCREC + HBO + NHB
) %>%
#Create table
flextable() %>%
theme_booktabs() %>%
colformat_double(j = 2:9,digits = 2) %>%
align(align = "center", part = "all") %>%
autofit(add_w = 0, add_h = 0) %>%
fit_to_width(6) %>%
hline(i = seq(11, 44, 11))
# Chunk 5: hh_emp_and_veh
tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
arrange(wrkcount, hhvehcnt) %>%
summarize(
n = n(),
HBW = weighted.mean(HBW, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBO = weighted.mean(HBO, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
"\U03A3" = HBW + HBSHOP + HBSOCREC + HBO + NHB
) %>%
flextable() %>%
theme_booktabs() %>%
colformat_double(j = 3:9,digits = 2) %>%
align(align = "center", part = "all") %>%
autofit(add_w = 0, add_h = 0) %>%
fit_to_width(6)
# Chunk 6: table_format
#Write formatting function to avoid clutter
format_my_table <- function(.data) {
flextable(.data) %>%
delete_part(part = "header") %>%
add_header(hhvehcnt = "Household Vehicles",
`1.x` = "1", `2.x` = "2", `3` = "3", `4` = "4",
`0` = "0", `1.y` = "1", `2.y` = "2") %>%
add_header(hhvehcnt = "",
`1.x` = "Size", `2.x` = "Size", `3` = "Size", `4` = "Size",
`0` = "Workers", `1.y` = "Workers", `2.y` = "Workers" ) %>%
merge_h(part = "header") %>%
theme_booktabs() %>%
colformat_double(j = 2:8, digits = 2) %>%
align(align = "center", part = "all") %>%
autofit(add_w = 0, add_h = 0) %>%
vline(j = c("hhvehcnt", "4"))
}
# Chunk 7: sd_veh_and_size_and_emp
size <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
arrange(hhsize, hhvehcnt) %>%
summarise(HBW = wtd.sd(HBW, wthhfin)) %>%
pivot_wider(names_from = hhsize, values_from = HBW)
emp <- tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
arrange(wrkcount, hhvehcnt) %>%
summarise(HBW = wtd.sd(HBW, wthhfin)) %>%
pivot_wider(names_from = wrkcount, values_from = HBW)
left_join(size, emp, by = "hhvehcnt") %>%
format_my_table() %>%  #Custom function to avoid clutter
set_caption("Weighted standard deviations of HBW trips",
autonum = F)
# Chunk 8: n_veh_and_size_and_emp
size <- tripprod %>%
group_by(hhsize, hhvehcnt) %>%
arrange(hhsize, hhvehcnt) %>%
summarise(n = n()) %>%
pivot_wider(names_from = hhsize, values_from = n)
emp <- tripprod %>%
group_by(wrkcount, hhvehcnt) %>%
arrange(wrkcount, hhvehcnt) %>%
summarise(n = n()) %>%
pivot_wider(names_from = wrkcount, values_from = n)
left_join(size, emp, by = "hhvehcnt") %>%
format_my_table() %>%  #Custom function to avoid clutter
set_caption("Number of households in each classification",
autonum = F)
# Chunk 9: trip_attr
psrc_attractions <- read_csv("https://byu.box.com/shared/static/7ci8vomip719bdno7xl5ftjj940dausm.csv")
# Chunk 10: attr_models_prelim
lm(data = psrc_attractions, HBW ~ tothh + retl + manu + offi + gved + othr + totemp) %>%
summary()
lm(data = psrc_attractions, HBW ~ tothh + retl + manu + offi + gved + othr + totemp) %>%
summary()
lm(data = psrc_attractions, HBW ~ tothh + retl + manu + offi + gved + othr + totemp) %>%
plot()
plot(HBW ~ tothh, data = psrc_attractions)
plot(HBW ~ totemp, data = psrc_attractions)
ggplot(HBW ~ totemp)
ggplot(data = psrc_attractions, HBW ~ totemp)
ggplot(data = psrc_attractions, aes(x = HBW, y = totemp))
ggplot(data = psrc_attractions, aes(x = HBW, y = totemp)) + geom_point()
ggplot(data = psrc_attractions, aes(x = HBW, y = totemp)) + geom_point() + geom_smooth(method = "lm")
ggplot(data = psrc_attractions, aes(x = HBW, y = retl)) + geom_point() + geom_smooth(method = "lm")
ggplot(data = psrc_attractions, aes(x = HBW, y = offi)) + geom_point() + geom_smooth(method = "lm")
ggplot(data = psrc_attractions, aes(x = HBW, y = manu)) + geom_point() + geom_smooth(method = "lm")
ggplot(data = psrc_attractions, aes(x = HBW, y = gved)) + geom_point() + geom_smooth(method = "lm")
ggplot(data = psrc_attractions, aes(x = HBW, y = gved)) +
geom_point() +
geom_smooth(method = "lm")
ggplot(data = psrc_attractions, aes(x = HBW, y = othr)) +
geom_point() +
geom_smooth(method = "lm")
lm(data = psrc_attractions, HBW ~ retl + manu + offi + gved + othr)
lm(data = psrc_attractions, HBW ~ retl + manu + offi + gved + othr) %>%
summary()
lm(data = psrc_attractions, HBW ~ manur) %>%
summary()
lm(data = psrc_attractions, HBW ~ manu) %>%
summary()
ggplot(data = psrc_attractions, aes(x = HBW, y = manu)) +
geom_point() +
geom_smooth(method = "lm")
lm(data = psrc_attractions, HBW ~ totemp) %>%
summary()
ggplot(data = psrc_attractions, aes(x = HBW, y = totemp)) +
geom_point() +
geom_smooth(method = "lm")
lm(data = psrc_attractions, HBW ~ retl + manu + offi + gved + othr + totemp) %>%
summary()
lm(data = psrc_attractions, HBW ~ retl + offi + gved + othr) %>%
summary()
lm(data = psrc_attractions, HBW ~ retl + offi + gved + othr) %>% plot()
ggplot(data = psrc_attractions, aes(x = HBW, y = offi)) +
geom_point() +
geom_smooth(method = "lm")
lm(data = psrc_attractions, HBW ~ offi + offi^2) %>%
summary()
lm(data = psrc_attractions, HBW ~ offi + I(offi^2)) %>%
summary()
?poly()
lm(data = psrc_attractions, HBW ~ poly(retl, offi, gved, othr, manu, degree = 2)) %>%
summary()
lm(data = psrc_attractions, HBW ~ poly(retl, degree = 2)) %>%
summary()
lm(data = psrc_attractions, HBW ~ poly(retl, 2)) %>%
summary()
lm(data = psrc_attractions, HBW ~ poly(retl +1, 2)) %>%
summary()
lm(data = psrc_attractions, HBW ~ poly(totemp, 2)) %>%
summary()
lm(data = psrc_attractions, HBW ~ poly(psrc_attractions$totemp, 2)) %>%
summary()
lm(data = psrc_attractions, HBW ~ totemp) %>%
summary()
lm(data = psrc_attractions, HBW ~ retl + offi + gved + othr) %>%
summary()
lm(data = psrc_attractions, HBW ~ offi + gved) %>%
summary()
lm(data = psrc_attractions, HBW ~ totemp + tothh) %>%
summary()
ggplot(data = psrc_attractions, aes(x = HBW, y = totemp)) +
geom_point() +
geom_smooth(method = "lm")
HBWlm <- lm(data = psrc_attractions, HBW ~ totemp) %>% summary()
HBWlm <- lm(data = psrc_attractions, HBW ~ totemp)
summary(HBWlm)
colnames(psrc_attractions)
lm(data = psrc_attractions, HBSHOP ~ tothh + totemp + retl + offi + manu + gved + othr) %>%
summary()
lm(data = psrc_attractions, HBShop ~ tothh + totemp + retl + offi + manu + gved + othr) %>%
summary()
lm(data = psrc_attractions, HBShop ~ retl + tothh) %>%
summary()
lm(data = psrc_attractions, HBShop ~ retl) %>%
summary()
ggplot(data = psrc_attractions, aes(x = HBShop, y = retl)) +
geom_point() +
geom_smooth(method = "lm")
colnames(psrc_attractions)
lm(data = psrc_attractions, HBO ~ tothh + totemp + retl + offi + manu + gved + othr) %>%
summary()
lm(data = psrc_attractions, HBO ~ tothh + totemp + retl) %>%
summary()
lm(data = psrc_attractions, HBO ~ tothh + retl) %>%
summary()
lm(data = psrc_attractions, HBO ~ tothh + retl + othr) %>%
summary()
lm(data = psrc_attractions, HBO ~ tothh + retl) %>%
summary()
lm(data = psrc_attractions, NHB ~ tothh + totemp + retl + offi + manu + gved + othr) %>%
summary()
ggplot(data = psrc_attractions, aes(x = HBO, y = tothh)) +
geom_point() +
geom_smooth(method = "lm")
lm(data = psrc_attractions, HBO ~ tothh + retl) %>% plot()
lm(data = psrc_attractions, NHB ~ tothh + totemp + retl + offi + manu + gved + othr) %>%
summary()
lm(data = psrc_attractions, NHB ~ tothh + totemp + retl + offi + manu + gved + othr) %>%
summary()
lm(data = psrc_attractions, NHB ~ retl + totemp + offi + gved) %>%
summary()
lm(data = psrc_attractions, NHB ~ retl + totemp + offi + gved + othr) %>%
summary()
lm(data = psrc_attractions, NHB ~ retl + totemp + offi + gved + tothh) %>%
summary()
lm(data = psrc_attractions, NHB ~ retl + totemp + offi + gved) %>%
summary()
lm(data = psrc_attractions, NHB ~ retl + offi + gved) %>%
summary()
