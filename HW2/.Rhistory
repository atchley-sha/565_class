knitr::opts_chunk$set(echo = FALSE)
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse)
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse, remotes, nhts2017)
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0.a
mutate_at(vars(names(trips)), nato0)
tripprod
tripprod
tripprod
tripprod %>%
group_by(hhsize, hhfaminc)
tripprod %>%
group_by(hhsize, hhfaminc)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize()
colnames(tripprod)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean('-9', wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(-9, wthhfin),
)
\% hello
# 2.1
Using this data, we can calculate trip rates by household size and income group:
```{r hh_size_and_income}
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(-9, wthhfin),
)
```
% hello
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
# Other = weighted.mean(-9, wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(tripprod$`-9`, wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(tripprod$'-9', wthhfin),
)
colnames(tripprod)
n(colnames(tripprod))
count(colnames(tripprod))
length(colnames(tripprod))
colnames(tripprod) <- c(
colnames(tripprod)[1,length(colnames(tripprod))-1],
"Other")
colnames(tripprod) <- c(
colnames(tripprod)[1,12],
"Other")
colnames(tripprod) <- c(
colnames(tripprod)[1:length(colnames(tripprod))-1],
"Other")
tripprod
colnames(tripprod)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
)
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
) %>%
print.data.frame()
if(!require(pacman)) install.packages(pacman)
pacman::p_load(
pacman,
tidyverse,
remotes,
nhts2017,
kableExtra
)
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse, remotes, nhts2017)
pacman::p_load(pacman, tidyverse, remotes, knitr, nhts2017)
tripprod
# Chunk 1: setup
knitr::opts_chunk$set(
echo = TRUE,
message = FALSE,
warning = FALSE
)
# Chunk 2: load_packages
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse, remotes, knitr, nhts2017)
# Chunk 3: load_data
hh <- nhts_households %>%
# filter to MSA size 2, travel on weekday
filter(msasize == "02", !travday %in% c("01", "07")) %>%
# select the columns we care about.
select(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) %>%
mutate(
hhsize = ifelse(hhsize > 4, 4, hhsize),
hhvehcnt = ifelse(hhvehcnt > 3, 3, hhvehcnt),
wrkcount = ifelse(wrkcount > 2, 2, wrkcount)
)
trips <- nhts_trips %>%
# filter to households in the data
filter(houseid %in% hh$houseid) %>%
group_by(houseid, trippurp) %>%
# count up how many trips each household took
summarise(trips = n()) %>%
# "spread" the data, filling zero if no trips were taken
pivot_wider(id_cols = houseid, names_from = trippurp,
values_from = trips, values_fill = 0)
# function to change NA to 0
nato0 <- function(x) {ifelse(is.na(x), 0, x)}
tripprod <- hh %>%
# join tables by id field
left_join(trips, by = "houseid") %>%
# change all NA values in columns from the trips data to 0.a
mutate_at(vars(names(trips)), nato0)
# Chunk 4: rename_9
colnames(tripprod) <- c(
colnames(tripprod)[1:length(colnames(tripprod))-1],
"Other")
tripprod
# Chunk 5: hh_size_and_income
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
) %>%
knitr::kable()
tripprod
as_label(tripprod$hhfaminc)
to_factor
as.factor(tripprod$hhfaminc)
attr(tripprod$hhfaminc, "label")
attr(tripprod$hhfaminc, "var.label")
attr(tripprod$hhfaminc, "var.labels")
description(tripprod)
subset(tripprod$hhfaminc)
subset(tripprod$hhfaminc, subset = TRUE)
if(!require(pacman)) install.packages(pacman)
pacman::p_load(pacman, tidyverse, remotes, knitr, nhts2017, sjlabelled)
library(sjlabelled)
get_labels(tripprod$hhfaminc)
to_label(tripprod$hhfaminc)
tripprod$hhfaminc
to_label(tripprod$hhfaminc)
tripprod$hhfaminc
to_character(tripprod$hhfaminc)
to_factor(tripprod$hhfaminc)
as_label(tripprod$hhfaminc, add.non.labelled = TRUE)
tripprod
head(as_label(tripprod$hhfaminc))
head(tripprod$hhfaminc)
as_label(tripprod)
to_label(tripprod$hhfaminc)
as_label(tripprod$hhfaminc)
as_labelled(tripprod$hhfaminc)
tripprod
tripprod %>%
group_by(hhsize, hhfaminc) %>%
summarize(
n = n(),
HBO = weighted.mean(HBO, wthhfin),
HBSHOP = weighted.mean(HBSHOP, wthhfin),
NHB = weighted.mean(NHB, wthhfin),
HBSOCREC = weighted.mean(HBSOCREC, wthhfin),
HBW = weighted.mean(HBW, wthhfin),
Other = weighted.mean(Other, wthhfin),
) %>%
as_label() %>%
knitr::kable()
tripprod
tripprod$hhfaminc
attr(tripprod$hhfaminc, "label")
attr(tripprod$hhfaminc, "labels")
