---
title: "Population and Job Densification in Roanoke"
author: "Hayden Atchley, Steven Goodsell, Austin Nichalson, Tristan Parker"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
geometry: margin=1in
output:
  pdf_document:
    latex_engine: lualatex
    includes:
      in_header: "preamble.tex"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```

```{r load_packages, include=FALSE}
if(!require(pacman)) install.packages("pacman")
pacman::p_load(
  char = as.character(read.csv("packages.csv", header = F)[,1])
  )
install_github("atchley-sha/R-packageSHA")
library(packageSHA)
```

```{r load_functions}
source("R/functions.R")
```

\RaggedRight
\graphicspath{ {./images/} }


# Introduction

Would densifying Roanokeâ€™s population and jobs in certain locations encourage multi-modal transportation and reduce problems like congestion? To seek answers to this question, our team used a trip-based model and changed the land-use inputs in the model by editing the projected 2040 social economic (SE) data. This allowed us to see how localizing population and job growth in the downtown area compares with the no-build 2040 scenario. We also wished to look at the effects of densifying "neighborhood centers" in comparison with the no-build scenario. We seek to identify if one or both of these land use policy changes would affect mode choice and traffic congestion, and to make a recommendation based on our findings.

# Proposed Scenarios

Our first scenario is the projected "No-Build" 2040 scenario, as given already in CUBE. For our other scenarios, we identified TAZs that we considered "Downtown", as well as those we considered "Neighborhood Centers". We mainly looked at the Area Type as given in the input data to determine these TAZs (with Downtown being urban and Neighborhood Centers being Exurban), but we adjusted our selections slightly to preserve continuity and cohesiveness. The area types and selected TAZs are shown in Figure \@ref(fig:TAZTypes).

As a side note, this figure shows that we had one obviously erroneous zone designated as Downtown. This is likely due to the fact that the TAZ data has three almost identical identification columns, and we may have mismatched them when combining the various input data files. This was an oversight on our part, but we unfortunately did not have time to fix the error. Most of the findings should still be roughly accurate, however, as only a couple of zones were affected.

```{r TAZTypes, fig.cap="Population density and selected TAZs for Downtown and Neighborhood Centers scenarios."}

#Set downtown zone IDs
DTZones <- c(88,89,90,91,92,
             93,102,117,118,119,
             126,127,128,129,130,
             131,132,133,134,145,
             195,196,197,198,200,
             201)

#Set neighborhood centers zone IDs
NCZones <- c(42,66,97,148,149,
             160,161,176,177,178,
             179,180,181)

TAZsf <- read_sf("data/TAZ/RoanokeTAZ.shp") %>% 
  select(ID, ZONE, N)

TAZdbf <- read.dbf("data/se/se_classified_2040_NO-BUILD.dbf") %>% 
  mutate(designation = case_when(Z %in% DTZones ~ "Downtown",
                          Z %in% NCZones ~ "Neighborhood Centers",
                          TRUE ~ "Rural") %>% 
           as.factor() %>% 
           fct_relevel(
             "Rural",
             "Neighborhood Center",
             "Downtown"
           )) %>% 
  select(Z, designation)

TAZtype <- read.dbf("data/ZONAL AT2040A.DBF")

TAZ <- left_join(TAZsf, TAZtype, by = c("N" = "N")) %>% 
  left_join(TAZdbf, by = c("ZONE" = "Z"))

TAZ$ATYPE <-  factor(
  TAZ$ATYPE,
  labels = c("2 - Urban",
             "3 - Exurban",
             "4 - Suburban",
             "5 - Rural"))

TAZsplit <- TAZ %>% 
  group_by(designation) %>% 
  group_split()

fillColors <- brewer.pal(4, "Oranges") %>% rev()
colorColors <- c("grey60", "blue", "black")
borderSize <- 0.7

ggplot(TAZ) +
  geom_sf(aes(fill = ATYPE, color = designation)) +
  theme_void() +
  scale_fill_manual(values = fillColors) +
  scale_color_manual(values = colorColors) +
  guides(color = guide_legend(override.aes = list(size = 1))) +
  geom_sf(data = TAZsplit[[2]], fill = NA, color = colorColors[2], size = borderSize) +
  geom_sf(data = TAZsplit[[3]], fill = NA, color = colorColors[3], size = borderSize) +
  labs(
    fill = "Area Type",
    color = "Designation"
  )

```

To create the other scenarios, we adjusted the No-Build socioeconomic input data by moving 30% of the population, jobs, etc. from the rural areas to the downtown and neighborhood centers areas, respectively. Figure \@ref(fig:populationMap) shows the No-Build population and employment density by TAZ, and Figures \@ref(fig:DTPOPDiff) and \@ref(NCPOPDiff) show the change from the No-Build scenario.

```{r loadSEData}
senb <- read.dbf("data/se/se_classified_2040_NO-BUILD.dbf") %>% 
  as_tibble() %>% 
  select(Z, POP, WORK) %>% 
  mutate(total = POP + WORK)
sedt <- read.dbf("data/se/se_downtown30.dbf") %>% 
  as_tibble() %>% 
  select(Z, POP, WORK) %>% 
  mutate(total = POP + WORK) %>% 
  calculate_differences(col = total, base = senb)
senc <- read.dbf("data/se/se_neighborhood30.dbf") %>% 
  as_tibble() %>% 
  select(Z, POP, WORK) %>% 
  mutate(total = POP + WORK) %>% 
  calculate_differences(col = total, base = senb)

TAZ <- read_sf("data/TAZ/RoanokeTAZ.shp") %>% 
  select(ID, ZONE, N)

```

```{r populationMap, fig.cap="Population by TAZ in No-Build scenario."}
TAZNB <- left_join(TAZ, senb, by = c("ZONE" = "Z"))

TAZNB %>% 
  ggplot() +
  geom_sf(aes(fill = total)) +
  theme_void() +
  scale_fill_gradient(low = "lightblue", high = "red") +
  labs(fill = "Population\n+ Employment")
```

```{r DTPOPDiff, fig.cap="Population difference in Downtown scenario from No-Build."}
TAZDT <- left_join(TAZ, sedt, by = c("ZONE" = "Z"))

ggplot(TAZDT) +
  geom_sf(aes(fill = DIFF)) +
  theme_void() +
  scale_fill_gradient2(low = "blue", mid = "gray80", high = "red") +
  labs(fill = "Population Difference\nfrom No-Build")
```

```{r NCPOPDiff, fig.cap="Population difference in Neighborhood Centers scenario from No-Build."}
TAZNC <- left_join(TAZ, senc, by = c("ZONE" = "Z"))

ggplot(TAZNC) +
  geom_sf(aes(fill = DIFF)) +
  theme_void() +
  scale_fill_gradient2(low = "blue", mid = "gray80", high = "red") +
  labs(fill = "Population Difference\nfrom No-Build")
```
